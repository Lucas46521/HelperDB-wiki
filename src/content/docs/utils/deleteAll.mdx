
---
title: deleteAll
description: Remove todos os dados armazenados no banco, realizando limpeza completa
---

# deleteAll()

Remove todos os dados armazenados no banco de dados, proporcionando uma forma r√°pida e segura de limpar completamente o armazenamento. √ötil para reset de dados, limpeza de cache e testes.

## Sintaxe

```typescript
await db.deleteAll(): Promise<boolean>
```

## Par√¢metros

Nenhum par√¢metro √© necess√°rio.

## Retorno

`true` se a opera√ß√£o foi bem-sucedida, `false` caso contr√°rio.

## Exemplos

### Limpeza Completa do Banco

```javascript
// Adicionar alguns dados de teste
await db.set('user.123', { name: 'Jo√£o', age: 25 });
await db.set('user.456', { name: 'Maria', age: 30 });
await db.set('config.theme', 'dark');
await db.set('cache.data', { lastUpdate: Date.now() });

// Verificar dados existentes
const beforeDelete = await db.all();
console.log(`Dados antes da limpeza: ${beforeDelete.length} registros`);

// Executar limpeza completa
const success = await db.deleteAll();
console.log(`Limpeza executada: ${success}`); // true

// Verificar que n√£o h√° mais dados
const afterDelete = await db.all();
console.log(`Dados ap√≥s limpeza: ${afterDelete.length} registros`); // 0
```

### Reset de Sistema

```javascript
// Simular dados de um sistema em produ√ß√£o
await db.set('sessions.user123', { token: 'abc123', expires: Date.now() + 3600000 });
await db.set('sessions.user456', { token: 'def456', expires: Date.now() + 3600000 });
await db.set('cache.products', [{ id: 1, name: 'Product 1' }]);
await db.set('logs.error', [{ message: 'Error occurred', timestamp: Date.now() }]);
await db.set('settings.app', { version: '1.0.0', debug: true });

console.log('üîÑ Iniciando reset do sistema...');

// Backup antes da limpeza (opcional)
const backupResult = await db.backup('./backup-before-reset.json');
console.log(`üì¶ Backup criado: ${backupResult.recordCount} registros salvos`);

// Executar reset completo
const resetSuccess = await db.deleteAll();

if (resetSuccess) {
  console.log('‚úÖ Reset do sistema conclu√≠do com sucesso');
  console.log('üóÇÔ∏è Banco de dados limpo completamente');
  
  // Recriar configura√ß√µes b√°sicas
  await db.set('settings.app', { 
    version: '1.0.0', 
    debug: false,
    installedAt: new Date().toISOString()
  });
  
  console.log('‚öôÔ∏è Configura√ß√µes b√°sicas restauradas');
} else {
  console.log('‚ùå Falha no reset do sistema');
}
```

### Limpeza de Cache

```javascript
// Simular cache com v√°rios tipos de dados
await db.set('cache.users.123', { name: 'Jo√£o', lastFetch: Date.now() });
await db.set('cache.products.page1', [{ id: 1, name: 'Product 1' }]);
await db.set('cache.api.weather', { temp: 25, humidity: 60 });
await db.set('cache.search.results', ['result1', 'result2']);

// Verificar tamanho do cache
const cacheSize = await db.count('');
console.log(`üìä Cache cont√©m ${cacheSize} itens`);

// Limpar todo o cache
console.log('üßπ Limpando cache...');
const cacheCleared = await db.deleteAll();

if (cacheCleared) {
  console.log('‚úÖ Cache limpo com sucesso');
  
  // Verificar que cache est√° vazio
  const newCacheSize = await db.count('');
  console.log(`üìä Cache agora cont√©m ${newCacheSize} itens`);
} else {
  console.log('‚ùå Erro ao limpar cache');
}
```

### Prepara√ß√£o para Testes

```javascript
// Fun√ß√£o auxiliar para limpar dados antes de cada teste
async function setupTestEnvironment() {
  console.log('üß™ Preparando ambiente de teste...');
  
  // Limpar todos os dados existentes
  await db.deleteAll();
  
  // Configurar dados de teste
  await db.set('test.config', {
    environment: 'test',
    startTime: Date.now(),
    testRunner: 'jest'
  });
  
  // Dados b√°sicos para testes
  await db.set('test.users', [
    { id: 1, name: 'Test User 1', email: 'test1@example.com' },
    { id: 2, name: 'Test User 2', email: 'test2@example.com' }
  ]);
  
  console.log('‚úÖ Ambiente de teste preparado');
}

// Executar antes de cada teste
async function runTest() {
  await setupTestEnvironment();
  
  // Seus testes aqui...
  const users = await db.get('test.users');
  console.log(`Testando com ${users.length} usu√°rios`);
  
  // Limpeza ap√≥s teste
  await db.deleteAll();
  console.log('üßπ Dados de teste limpos');
}

await runTest();
```

### Manuten√ß√£o Peri√≥dica

```javascript
// Sistema de limpeza autom√°tica com verifica√ß√µes
async function performMaintenance() {
  console.log('üîß Iniciando manuten√ß√£o do sistema...');
  
  // Verificar tamanho atual dos dados
  const currentData = await db.all();
  const dataSize = currentData.length;
  
  console.log(`üìä Dados atuais: ${dataSize} registros`);
  
  // Criar backup antes da manuten√ß√£o
  if (dataSize > 0) {
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const backupPath = `./maintenance-backup-${timestamp}.json`;
    
    const backup = await db.backup(backupPath);
    console.log(`üíæ Backup criado: ${backup.recordCount} registros em ${backupPath}`);
  }
  
  // Executar limpeza
  const cleanupSuccess = await db.deleteAll();
  
  if (cleanupSuccess) {
    console.log('‚úÖ Limpeza de manuten√ß√£o conclu√≠da');
    
    // Restaurar apenas dados essenciais
    await db.set('system.maintenance', {
      lastCleanup: new Date().toISOString(),
      recordsCleaned: dataSize,
      status: 'completed'
    });
    
    console.log('üìù Log de manuten√ß√£o registrado');
  } else {
    console.log('‚ùå Falha na limpeza de manuten√ß√£o');
  }
}

// Executar manuten√ß√£o
await performMaintenance();
```

## Casos de Uso

### üß™ **Ambiente de Testes**
```javascript
// Limpar dados entre testes
beforeEach(async () => {
  await db.deleteAll();
});

// Setup de dados limpos para cada teste
afterAll(async () => {
  await db.deleteAll();
});
```

### üîÑ **Reset de Aplica√ß√£o**
```javascript
// Reset completo da aplica√ß√£o
async function resetApplication() {
  const backup = await db.backup('./pre-reset-backup.json');
  await db.deleteAll();
  
  // Reconfigurar estado inicial
  await initializeDefaultData();
}
```

### üóëÔ∏è **Limpeza de Cache**
```javascript
// Limpeza peri√≥dica de cache
setInterval(async () => {
  await db.deleteAll();
  console.log('Cache limpo automaticamente');
}, 24 * 60 * 60 * 1000); // A cada 24 horas
```

### üîß **Manuten√ß√£o de Sistema**
```javascript
// Manuten√ß√£o programada
async function scheduledMaintenance() {
  const backup = await db.backup('./scheduled-backup.json');
  await db.deleteAll();
  
  // Otimizar banco ap√≥s limpeza
  await db.init(); // Reinicializar estruturas
}
```

## Caracter√≠sticas Importantes

### ‚ö° **Opera√ß√£o At√¥mica**
- Remove todos os dados em uma √∫nica opera√ß√£o
- Transa√ß√£o segura que n√£o deixa dados parciais
- Rollback autom√°tico em caso de erro

### üõ°Ô∏è **Seguran√ßa**
- Opera√ß√£o irrevers√≠vel - use com cuidado
- Recomendado fazer backup antes da execu√ß√£o
- Valida√ß√£o interna para prevenir execu√ß√£o acidental

### üöÄ **Performance**
- Muito mais r√°pido que deletar item por item
- Otimizado para limpeza de grandes volumes
- N√£o carrega dados na mem√≥ria durante remo√ß√£o

## Valida√ß√£o e Seguran√ßa

```javascript
// ‚úÖ Verificar se h√° dados antes de limpar
const hasData = await db.count('');
if (hasData > 0) {
  console.log(`‚ö†Ô∏è Aten√ß√£o: ${hasData} registros ser√£o removidos`);
  
  // Criar backup autom√°tico
  const backup = await db.backup('./auto-backup.json');
  console.log(`üíæ Backup autom√°tico criado: ${backup.recordCount} registros`);
  
  // Executar limpeza
  await db.deleteAll();
}

// ‚úÖ Verificar sucesso da opera√ß√£o
const success = await db.deleteAll();
if (!success) {
  console.error('‚ùå Falha na opera√ß√£o de limpeza');
  // Implementar recupera√ß√£o ou notifica√ß√£o
}

// ‚úÖ Validar que limpeza foi completa
const remainingData = await db.all();
if (remainingData.length === 0) {
  console.log('‚úÖ Limpeza verificada - banco completamente limpo');
} else {
  console.warn(`‚ö†Ô∏è Ainda restam ${remainingData.length} registros`);
}
```

## M√©todos Relacionados

- [`backup()`](./backup.mdx) - Criar backup antes da limpeza
- [`restore()`](./restore.mdx) - Restaurar dados ap√≥s limpeza
- [`all()`](./all.mdx) - Verificar dados existentes
- [`count()`](./count.mdx) - Contar registros antes da limpeza
- [`delete()`](./delete.mdx) - Remover registros espec√≠ficos

## Padr√£o de Uso Seguro

```javascript
class SafeDeleteAll {
  constructor(db) {
    this.db = db;
  }
  
  async deleteAllWithBackup(backupPath = null) {
    try {
      // 1. Contar dados existentes
      const dataCount = await this.db.count('');
      
      if (dataCount === 0) {
        console.log('‚ÑπÔ∏è Banco j√° est√° vazio');
        return { success: true, deletedCount: 0 };
      }
      
      // 2. Criar backup autom√°tico
      if (!backupPath) {
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        backupPath = `./backup-${timestamp}.json`;
      }
      
      const backup = await this.db.backup(backupPath);
      console.log(`üíæ Backup criado: ${backup.recordCount} registros`);
      
      // 3. Executar limpeza
      const success = await this.db.deleteAll();
      
      if (success) {
        // 4. Verificar limpeza
        const remainingCount = await this.db.count('');
        
        return {
          success: true,
          deletedCount: dataCount,
          backupPath,
          verified: remainingCount === 0
        };
      } else {
        throw new Error('Falha na opera√ß√£o deleteAll');
      }
      
    } catch (error) {
      console.error('‚ùå Erro na limpeza segura:', error.message);
      return { success: false, error: error.message };
    }
  }
  
  async deleteAllWithConfirmation(confirmationText = 'DELETE') {
    console.log(`‚ö†Ô∏è Esta opera√ß√£o ir√° remover TODOS os dados!`);
    console.log(`Digite "${confirmationText}" para confirmar:`);
    
    // Em ambiente real, usar readline ou prompt do usu√°rio
    const userInput = confirmationText; // Simular confirma√ß√£o
    
    if (userInput === confirmationText) {
      return await this.deleteAllWithBackup();
    } else {
      console.log('‚ùå Opera√ß√£o cancelada - confirma√ß√£o incorreta');
      return { success: false, error: 'Opera√ß√£o cancelada pelo usu√°rio' };
    }
  }
}

// Uso da classe segura
const safeDelete = new SafeDeleteAll(db);

// Limpeza com backup autom√°tico
const result = await safeDelete.deleteAllWithBackup();
console.log(`Resultado: ${result.success ? 'Sucesso' : 'Falha'}`);

// Limpeza com confirma√ß√£o
const confirmedResult = await safeDelete.deleteAllWithConfirmation('DELETE');
```

## Dicas de Seguran√ßa

```javascript
// ‚úÖ SEMPRE fazer backup antes de deleteAll em produ√ß√£o
const backup = await db.backup(`./backup-${Date.now()}.json`);
await db.deleteAll();

// ‚úÖ Implementar confirma√ß√£o em ambientes cr√≠ticos
const isProduction = process.env.NODE_ENV === 'production';
if (isProduction) {
  console.log('‚ö†Ô∏è ATEN√á√ÉO: Opera√ß√£o em ambiente de produ√ß√£o!');
  // Implementar confirma√ß√£o adicional
}

// ‚úÖ Usar em transa√ß√µes quando dispon√≠vel
if (db.enableTransactions) {
  const transaction = await db.beginTransaction();
  try {
    await db.deleteAll();
    await db.commitTransaction(transaction);
  } catch (error) {
    await db.rollbackTransaction(transaction);
  }
}

// ‚ùå NUNCA usar deleteAll sem backup em produ√ß√£o
// await db.deleteAll(); // Perigoso em produ√ß√£o

// ‚ùå NUNCA usar em scripts automatizados sem valida√ß√£o
// setInterval(() => db.deleteAll(), 1000); // Extremamente perigoso
```
